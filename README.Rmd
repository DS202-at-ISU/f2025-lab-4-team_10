---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit the README.Rmd file -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Lab report #4 - instructions

Follow the instructions posted at <https://ds202-at-isu.github.io/labs.html> for the lab assignment. The work is meant to be finished during the lab time, but you have time until Monday (after Thanksgiving) to polish things.

All submissions to the github repo will be automatically uploaded for grading once the due date is passed. Submit a link to your repository on Canvas (only one submission per team) to signal to the instructors that you are done with your submission.

# Lab 4: Scraping (into) the Hall of Fame


```{r echo=FALSE, message=FALSE, warning=FALSE}
hof <- Lahman::HallOfFame
hof %>% 
  ggplot(aes(x = yearID, y = votes/needed*100, group=playerID)) +
  geom_hline(yintercept = 100, colour="grey70") + 
  geom_line() +
  geom_point(aes(colour = "inducted"), 
    data = hof %>% filter(inducted=="Y")) +
  xlim(c(2000, 2022)) +
  ylab("Percent of votes")
```


## Deesha's Work 

```{r}
library(rvest)
library(dplyr)
library(janitor)
library(readr)

# Scrape the webpage
url <- "https://www.baseball-reference.com/awards/hof_2025.shtml"
html <- read_html(url)
tables <- html_table(html)
raw <- tables[[1]]

# Use first row as column names
colnames(raw) <- as.character(unlist(raw[1, ]))
data <- raw[-1, ]  
data <- as.data.frame(data, stringsAsFactors = FALSE)

# Clean column names
data <- data %>% janitor::clean_names()
colnames(data) <- make.names(colnames(data), unique = TRUE)

print("Available columns:")
print(colnames(data))

# Convert numeric columns
cleaned <- data

if("votes" %in% names(cleaned)) {
  cleaned$votes <- parse_number(cleaned$votes)
}
if("percent_vote" %in% names(cleaned)) {
  cleaned$percent_vote <- parse_number(cleaned$percent_vote)
}
if("yrs" %in% names(cleaned)) {
  cleaned$yrs <- parse_number(cleaned$yrs)
}
if("war" %in% names(cleaned)) {
  cleaned$war <- as.numeric(cleaned$war)
}
if("war7" %in% names(cleaned)) {
  cleaned$war7 <- as.numeric(cleaned$war7)
}
if("jaws" %in% names(cleaned)) {
  cleaned$jaws <- as.numeric(cleaned$jaws)
}
if("hofm" %in% names(cleaned)) {
  cleaned$hofm <- as.numeric(cleaned$hofm)
}
if("hofs" %in% names(cleaned)) {
  cleaned$hofs <- as.numeric(cleaned$hofs)
}

# Check the scraped data
head(cleaned)
str(cleaned)

# Transform to match Lahman HallOfFame format
# Calculate total ballots (you may need to look this up or extract from the page)
total_ballots <- 394  # This is the actual number for 2025, adjust if needed

HallOfFame_2025 <- cleaned %>%
  mutate(
    playerID = gsub(" ", "", tolower(name)),  # Simple playerID creation
    yearID = 2025,
    votedBy = "BBWAA",
    ballots = total_ballots,
    needed = ceiling(ballots * 0.75),  # 75% threshold
    inducted = ifelse(votes >= needed, "Y", "N"),
    category = "Player"
  ) %>%
  select(playerID, yearID, votedBy, ballots, needed, votes, inducted, category)

# View the final dataset
head(HallOfFame_2025)

# Save as CSV (required deliverable)
write.csv(HallOfFame_2025, file = "HallOfFame_2025.csv", row.names = FALSE)

# Or use readr version
readr::write_csv(HallOfFame_2025, file = "HallOfFame_2025.csv")

```


## Deesha's Notes on Process

### Scraping
- Scraped data from https://www.baseball-reference.com/awards/hof_2025.shtml using `rvest`
- Extracted column names from first row, then removed it
- Cleaned column names with `janitor::clean_names()`

### Cleaning
- Used `parse_number()` to remove %, ordinals (1st, 2nd) from numeric columns
- Converted statistics to numeric with `as.numeric()`
- NAs are expected for missing player stats

### Transformation
Added columns to match Lahman format:
- `yearID = 2025`, `votedBy = "BBWAA"`, `category = "Player"`
- `ballots = 394`, `needed = 296` (75% threshold)
- `inducted = "Y"` if votes >= needed, else "N"
- Created simple `playerID` from player names

### Issues
- PlayerID may not match official Lahman IDs (needs verification)

### Reusability
For future years: update URL year, yearID, and ballot count

### Output
Saved as `HallOfFame_2025.csv`


