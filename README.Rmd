---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit the README.Rmd file -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rvest)
library(readr)
library(Lahman)
```

# Lab report #4 - instructions

Follow the instructions posted at <https://ds202-at-isu.github.io/labs.html> for the lab assignment. The work is meant to be finished during the lab time, but you have time until Monday (after Thanksgiving) to polish things.

All submissions to the github repo will be automatically uploaded for grading once the due date is passed. Submit a link to your repository on Canvas (only one submission per team) to signal to the instructors that you are done with your submission.

# Lab 4: Scraping (into) the Hall of Fame


```{r echo=FALSE, message=FALSE, warning=FALSE}
hof <- Lahman::HallOfFame
hof %>% 
  ggplot(aes(x = yearID, y = votes/needed*100, group=playerID)) +
  geom_hline(yintercept = 100, colour="grey70") + 
  geom_line() +
  geom_point(aes(colour = "inducted"), 
    data = hof %>% filter(inducted=="Y")) +
  xlim(c(2000, 2022)) +
  ylab("Percent of votes")
```


## Deesha's Work 

```{r}
library(rvest)
library(dplyr)
library(janitor)
library(readr)


url <- "https://www.baseball-reference.com/awards/hof_2025.shtml"
html <- read_html(url)
tables <- html_table(html)
raw <- tables[[1]]

colnames(raw) <- as.character(unlist(raw[1, ]))
data <- raw[-1, ]  
data <- as.data.frame(data, stringsAsFactors = FALSE)

data <- data %>% janitor::clean_names()
colnames(data) <- make.names(colnames(data), unique = TRUE)

print("Available columns:")
print(colnames(data))

cleaned <- data

if("votes" %in% names(cleaned)) {
  cleaned$votes <- parse_number(cleaned$votes)
}
if("percent_vote" %in% names(cleaned)) {
  cleaned$percent_vote <- parse_number(cleaned$percent_vote)
}
if("yrs" %in% names(cleaned)) {
  cleaned$yrs <- parse_number(cleaned$yrs)
}
if("war" %in% names(cleaned)) {
  cleaned$war <- as.numeric(cleaned$war)
}
if("war7" %in% names(cleaned)) {
  cleaned$war7 <- as.numeric(cleaned$war7)
}
if("jaws" %in% names(cleaned)) {
  cleaned$jaws <- as.numeric(cleaned$jaws)
}
if("hofm" %in% names(cleaned)) {
  cleaned$hofm <- as.numeric(cleaned$hofm)
}
if("hofs" %in% names(cleaned)) {
  cleaned$hofs <- as.numeric(cleaned$hofs)
}

head(cleaned)
str(cleaned)


total_ballots <- 394  

HallOfFame_2025 <- cleaned %>%
  mutate(
    playerID = gsub(" ", "", tolower(name)),  
    yearID = 2025,
    votedBy = "BBWAA",
    ballots = total_ballots,
    needed = ceiling(ballots * 0.75),  
    inducted = ifelse(votes >= needed, "Y", "N"),
    category = "Player"
  ) %>%
  select(playerID, yearID, votedBy, ballots, needed, votes, inducted, category)

head(HallOfFame_2025)

write.csv(HallOfFame_2025, file = "HallOfFame_2025.csv", row.names = FALSE)

readr::write_csv(HallOfFame_2025, file = "HallOfFame_2025.csv")

```


## Deesha's Notes on Process

### Scraping
- Scraped data from https://www.baseball-reference.com/awards/hof_2025.shtml using `rvest`
- Extracted column names from first row, then removed it
- Cleaned column names with `janitor::clean_names()`

### Cleaning
- Used `parse_number()` to remove %, ordinals (1st, 2nd) from numeric columns
- Converted statistics to numeric with `as.numeric()`
- NAs are expected for missing player stats

### Transformation
Added columns to match Lahman format:
- `yearID = 2025`, `votedBy = "BBWAA"`, `category = "Player"`
- `ballots = 394`, `needed = 296` (75% threshold)
- `inducted = "Y"` if votes >= needed, else "N"
- Created simple `playerID` from player names

### Issues
- PlayerID may not match official Lahman IDs (needs verification)

### Reusability
For future years: update URL year, yearID, and ballot count

### Output
Saved as `HallOfFame_2025.csv`

### Maya's Work 
```{r mayas work}
library(dplyr)
library(ggplot2)
library(Lahman)

hof_lahman_2025 <- HallOfFame %>%
filter(yearID == 2025, votedBy == "BBWAA") %>%
arrange(desc(votes))

#candidates
nrow(hof_lahman_2025)
nrow(HallOfFame_2025)

sum(hof_lahman_2025$votes, na.rm = TRUE)
sum(HallOfFame_2025$votes, na.rm = TRUE)

cleaned %>%
arrange(desc(votes)) %>%
select(name, votes, percent_vote, war) %>%
head(10)

#quick check 
cleaned %>%
filter(!is.na(war), !is.na(percent_vote)) %>%
ggplot(aes(x = war, y = percent_vote)) +
geom_point() +
labs(
title = "Hall of Fame 2025: WAR vs BBWAA vote share",
x = "Career WAR",
y = "Percent of votes"
)

#bar chart 
cleaned %>%
arrange(desc(votes)) %>%
slice_head(n = 15) %>%
ggplot(aes(x = reorder(name, votes), y = votes)) +
geom_col() +
coord_flip() +
labs(
title = "Top 15 vote getters on the 2025 Hall of Fame ballot",
x = "Player",
y = "Number of votes"
)

```

### Maya (Notes on my Process)

For my part of the assignment, I really wanted to double-check that our scraped dataset lined up with the official Lahman HallOfFame data so I knew nothing got lost or duplicated along the way. I pulled the 2025 BBWAA voting results directly from Lahman and compared them with the table Deesha scraped. Both datasets had the same number of candidates (28), and the total number of votes added up to the exact same amount (2667). That immediately made me feel confident that our version was accurate.

After that, I looked at the top vote-getters by sorting our cleaned dataset in descending order. I printed out their names, vote counts, percent of the vote, and WAR values just to get a sense of whether the results matched what I expected. Seeing Ichiro and CC Sabathia at the top was a good sign that everything aligned with baseball reality and that the scraped data made sense.

Once the basic checks lined up, I wanted to visualize the data a bit. My first plot looked at WAR versus percent of the vote, mostly because I was curious whether players with higher WAR generally get more support from the writers. The pattern showed up the way I expected since stronger career stats tend to lead to higher vote percentages, but there were still a couple interesting outliers. I also made a bar chart of the top 15 vote-getters, which made it easier to see how much higher players like Ichiro and CC Sabathia ranked compared to everyone else.

Overall, my main goal in this section was to validate that our scraped dataset matched Lahmanâ€™s version and then explore the 2025 ballot in a simple, visual way. Everything matched up perfectly, so I feel confident about the dataset our team is submitting.

